{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/Desktop/8-preact-end-main/app/%28main%29/profile/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState, useRef } from \"react\";\nimport axios from \"axios\";\nimport Cookies from \"js-cookie\";\nimport { Camera, User, Loader2, Calendar } from \"lucide-react\";\nimport { toast, Toaster } from \"react-hot-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\n\nconst Profile = () => {\n  const queryClient = useQueryClient();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const [formData, setFormData] = useState({\n    first_name: \"\",\n    last_name: \"\",\n    email: \"\",\n    role: \"\",\n    current_password: \"\",\n    new_password: \"\",\n  });\n\n  const BASE_URL = process.env.NEXT_PUBLIC_BASE_URL || \"http://localhost:7070\";\n  const token = Cookies.get(\"token\");\n\n  const { data: user, isLoading: loading } = useQuery({\n    queryKey: [\"profile\"],\n    queryFn: () => {\n      const savedUser = Cookies.get(\"user\") || localStorage.getItem(\"user\");\n      if (savedUser) {\n        const parsed = JSON.parse(savedUser);\n        return parsed.data ? parsed.data : parsed;\n      }\n      return null;\n    },\n    staleTime: Infinity,\n  });\n\n  useEffect(() => {\n    if (user) {\n      setFormData((prev) => ({\n        ...prev,\n        first_name: user.first_name || \"\",\n        last_name: user.last_name || \"\",\n        email: user.email || \"\",\n        role: user.role || \"manager\",\n      }));\n    }\n  }, [user]);\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      await axios.post(\n        `${BASE_URL}/api/auth/edit-profile`,\n        {\n          first_name: data.first_name,\n          last_name: data.last_name,\n          email: data.email,\n        },\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        },\n      );\n\n      if (data.current_password && data.new_password) {\n        await axios.post(\n          `${BASE_URL}/api/auth/edit-password`,\n          {\n            current_password: data.current_password,\n            new_password: data.new_password,\n          },\n          {\n            headers: { Authorization: `Bearer ${token}` },\n          },\n        );\n      }\n    },\n    onSuccess: () => {\n      const updatedUser = { ...user, ...formData };\n      Cookies.set(\"user\", JSON.stringify(updatedUser));\n      localStorage.setItem(\"user\", JSON.stringify(updatedUser));\n      queryClient.setQueryData([\"profile\"], updatedUser);\n      toast.success(\"Muvaffaqiyatli yangilandi\");\n      setFormData((prev) => ({\n        ...prev,\n        current_password: \"\",\n        new_password: \"\",\n      }));\n    },\n    onError: () => {\n      toast.error(\"Yangilashda xatolik\");\n    },\n  });\n\n  const uploadImageMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const form = new FormData();\n      form.append(\"image\", file);\n      const response = await axios.post(\n        `${BASE_URL}/api/auth/edit-profile-img`,\n        form,\n        {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            \"Content-Type\": \"multipart/form-data\",\n          },\n        },\n      );\n      return response.data?.image || response.data?.data?.image;\n    },\n    onSuccess: (newImagePath) => {\n      const updatedUser = {\n        ...user,\n        image: newImagePath || user?.image,\n      };\n      Cookies.set(\"user\", JSON.stringify(updatedUser));\n      localStorage.setItem(\"user\", JSON.stringify(updatedUser));\n      queryClient.setQueryData([\"profile\"], updatedUser);\n      toast.success(\"Rasm muvaffaqiyatli yangilandi\");\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n    },\n    onError: (error: any) => {\n      toast.error(error.response?.data?.message || \"Rasmni yuklashda xatolik\");\n    },\n  });\n\n  const getProfileImg = () => {\n    if (!user?.image) return null;\n    return user.image.startsWith(\"http\")\n      ? user.image\n      : `${BASE_URL}/${user.image}`;\n  };\n\n  if (loading)\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-background\">\n        <Loader2 className=\"animate-spin text-primary\" />\n      </div>\n    );\n\n  return (\n    <div className=\"w-full p-4 md:p-8 bg-background text-foreground\">\n      <Toaster position=\"top-center\" />\n\n      <div className=\"max-w-5xl mx-auto\">\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12\">\n          <div className=\"flex items-center gap-5\">\n            <div className=\"relative group\">\n              <div className=\"w-20 h-20 md:w-24 md:h-24 rounded-full border-2 border-border overflow-hidden bg-muted\">\n                {getProfileImg() ? (\n                  <img\n                    src={getProfileImg()}\n                    alt=\"User\"\n                    className=\"w-full h-full object-cover\"\n                  />\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center text-muted-foreground\">\n                    <User size={40} />\n                  </div>\n                )}\n                {uploadImageMutation.isPending && (\n                  <div className=\"absolute inset-0 bg-background/60 flex items-center justify-center z-10\">\n                    <Loader2 className=\"animate-spin text-primary\" size={24} />\n                  </div>\n                )}\n              </div>\n              <button\n                type=\"button\"\n                disabled={uploadImageMutation.isPending}\n                onClick={() => fileInputRef.current?.click()}\n                className=\"absolute bottom-0 right-0 bg-primary text-primary-foreground p-2 rounded-full border-2 border-background hover:scale-110 transition-all shadow-md disabled:opacity-50\"\n              >\n                <Camera size={14} />\n              </button>\n              <input\n                type=\"file\"\n                hidden\n                ref={fileInputRef}\n                accept=\"image/*\"\n                onChange={(e) => {\n                  if (e.target.files?.[0])\n                    uploadImageMutation.mutate(e.target.files[0]);\n                }}\n              />\n            </div>\n\n            <div>\n              <h2 className=\"text-2xl md:text-3xl font-bold\">\n                {user?.first_name} {user?.last_name}\n              </h2>\n              <p className=\"text-muted-foreground text-sm\">{user?.email}</p>\n              <div className=\"flex items-center gap-2 text-muted-foreground text-xs mt-1\">\n                <Calendar size={12} /> Qo'shilgan:{\" \"}\n                {user?.createdAt?.split(\"T\")[0] || \"2025-06-04\"}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-destructive text-destructive-foreground text-[10px] md:text-xs font-bold px-4 py-1.5 rounded-md uppercase tracking-widest shadow-sm\">\n            {user?.role || \"manager\"}\n          </div>\n        </div>\n\n        <div className=\"space-y-8\">\n          <div>\n            <h3 className=\"text-lg font-semibold mb-1\">Profil ma'lumotlari</h3>\n            <p className=\"text-muted-foreground text-sm mb-6\">\n              Shaxsiy ma'lumotlaringiz va parolni yangilashingiz mumkin.\n            </p>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium opacity-80\">Ism</label>\n                <input\n                  className=\"w-full bg-muted border border-border rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\n                  value={formData.first_name}\n                  onChange={(e) =>\n                    setFormData({ ...formData, first_name: e.target.value })\n                  }\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium opacity-80\">\n                  Familiya\n                </label>\n                <input\n                  className=\"w-full bg-muted border border-border rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\n                  value={formData.last_name}\n                  onChange={(e) =>\n                    setFormData({ ...formData, last_name: e.target.value })\n                  }\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium opacity-80\">Email</label>\n                <input\n                  className=\"w-full bg-muted border border-border rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\n                  value={formData.email}\n                  onChange={(e) =>\n                    setFormData({ ...formData, email: e.target.value })\n                  }\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium opacity-80\">Rol</label>\n                <input\n                  className=\"w-full bg-muted border border-border rounded-lg px-4 py-3 text-sm cursor-not-allowed opacity-60 outline-none\"\n                  value={formData.role}\n                  disabled\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium opacity-80\">\n                  Joriy parol\n                </label>\n                <input\n                  type=\"password\"\n                  autoComplete=\"current-password\"\n                  className=\"w-full bg-muted border border-border rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\n                  value={formData.current_password}\n                  onChange={(e) =>\n                    setFormData({\n                      ...formData,\n                      current_password: e.target.value,\n                    })\n                  }\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium opacity-80\">\n                  Yangi parol\n                </label>\n                <input\n                  type=\"password\"\n                  autoComplete=\"new-password\"\n                  className=\"w-full bg-muted border border-border rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\n                  value={formData.new_password}\n                  onChange={(e) =>\n                    setFormData({ ...formData, new_password: e.target.value })\n                  }\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex justify-end mt-4\">\n            <button\n              onClick={() => updateProfileMutation.mutate(formData)}\n              disabled={updateProfileMutation.isPending}\n              className=\"px-10 py-2.5 bg-primary text-primary-foreground font-bold rounded-lg hover:opacity-90 transition-all flex items-center justify-center gap-2 shadow-md active:scale-95 disabled:opacity-50\"\n            >\n              {updateProfileMutation.isPending && (\n                <Loader2 size={16} className=\"animate-spin\" />\n              )}\n              O'zgartirish\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Profile;\n"],"names":[],"mappings":"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"}}]
}